---

````markdown
# 📦 Setup Daily Backup for EKS Disaster Recovery - Velero

---

## 📋 Plan

- ✅ Keep plan ready for EKS DR cluster in another region  
- ✅ Take daily backup of EKS cluster using Velero  
- ✅ Setup the backup storage (S3 bucket) and enable **Cross-Region Replication** for disaster recovery  

---

## ⚙️ Velero Setup

---

### 1. Install Velero on Client/Local Machine

```bash
$ wget https://github.com/vmware-tanzu/velero/releases/download/v1.16.0/velero-v1.16.0-linux-amd64.tar.gz
$ tar zxvf velero-v1.16.0-linux-amd64.tar.gz
$ sudo mv velero-v1.16.0-linux-amd64/velero /usr/local/bin/velero
````

---

### 2. Install Velero on EKS Cluster

```bash
$ velero install \
  --provider aws \
  --plugins velero/velero-plugin-for-aws:v1.10.0 \
  --bucket wezvatech-eks-backup \
  --secret-file /home/ubuntu/.aws/credentials \
  --backup-location-config region=ap-south-1 \
  --snapshot-location-config region=ap-south-1
```

**Verify Velero agent is running:**

```bash
$ kubectl get pods -n velero
```

---

### 3. Setup Jenkins Job for Daily Backup

---

#### 🔹 Create Service Account for Jenkins in EKS Cluster

```bash
$ kubectl apply -f sa.yml
```

#### 🔹 Create Role and RoleBinding for Service Account

```bash
$ kubectl apply -f role.yml role-bind.yml
```

#### 🔹 Create Service Account Token

```bash
$ kubectl apply -f sa-token.yml
```

#### 🔹 Describe Service Account Token Secret and Setup in Jenkins Credentials

```bash
$ kubectl describe secret eks-token -n velero
```

---

### 4. Develop Jenkinsfile for Daily Backup

* Include backup script using Velero commands
* Trigger it on a daily schedule using Jenkins

---

## 🔧 Velero Commands Reference

---

### 🔄 Backup

```bash
# Create a backup of all namespaces
velero backup create <backup-name> --ttl 72h0m0s

# Backup a specific namespace
velero backup create <backup-name> --include-namespaces <namespace>

# Backup specific resources
velero backup create <backup-name> --include-resources deployments,services

# Backup with a label selector
velero backup create <backup-name> --selector app=myapp

# Describe a backup
velero backup describe <backup-name> --details

# Get all backups
velero backup get

# Delete a backup
velero backup delete <backup-name>
```

---

### ♻️ Restore

```bash
# Restore from a backup
velero restore create --from-backup <backup-name>

# Restore to a different namespace
velero restore create --from-backup <backup-name> \
  --namespace-mappings old-namespace:new-namespace

# Get all restores
velero restore get

# Describe a restore
velero restore describe <restore-name> --details

# Delete a restore
velero restore delete <restore-name>
```

---

### 🔍 Snapshots & Logs

```bash
# Get backup logs
velero backup logs <backup-name>

# Get restore logs
velero restore logs <restore-name>

# View volume snapshots
velero snapshot-location get
```

---

## 👨‍💻 Author

**Vijay**

```

---

